"use strict";(self["webpackChunk_student_task_client"]=self["webpackChunk_student_task_client"]||[]).push([[413],{413:function(e,n,t){t.r(n),t.d(n,{default:function(){return u}});var o=function(){var e=this,n=e._self._c;return n("div",{staticClass:"login-container"},[e._m(0),n("div",{staticClass:"login-form"},[n("van-cell-group",[n("van-field",{attrs:{name:"email",label:"邮箱",placeholder:"请输入邮箱地址",rules:e.emailRules,"left-icon":"envelop-o",clearable:""},model:{value:e.form.email,callback:function(n){e.$set(e.form,"email",n)},expression:"form.email"}}),n("van-field",{attrs:{name:"code",label:"验证码",placeholder:"请输入6位验证码",rules:e.codeRules,"left-icon":"shield-o",clearable:"",maxlength:"6"},scopedSlots:e._u([{key:"button",fn:function(){return[n("van-button",{attrs:{size:"small",type:"primary",disabled:!e.canSendCode||e.sendingCode,loading:e.sendingCode},on:{click:e.handleSendCode}},[e._v(" "+e._s(e.sendButtonText)+" ")])]},proxy:!0}]),model:{value:e.form.code,callback:function(n){e.$set(e.form,"code",n)},expression:"form.code"}}),n("div",{staticClass:"login-button-container"},[n("van-button",{attrs:{round:"",block:"",type:"primary",loading:e.loggingIn,disabled:!e.form.email||!e.form.code},on:{click:e.handleLogin}},[e._v(" "+e._s(e.loggingIn?"登录中...":"登录")+" ")])],1)],1)],1),e._m(1)])},i=[function(){var e=this,n=e._self._c;return n("div",{staticClass:"login-header"},[n("h1",{staticClass:"login-title"},[e._v("学生任务管理")]),n("p",{staticClass:"login-subtitle"},[e._v("请使用邮箱验证码登录")])])},function(){var e=this,n=e._self._c;return n("div",{staticClass:"login-tips"},[n("p",[e._v("📧 首次登录将自动创建账号")]),n("p",[e._v("🔒 验证码有效期为5分钟")]),n("p",[e._v("⏰ 同一邮箱1分钟内只能发送一次验证码")])])}],s=(t(8014),t(4202)),a=t(1406),l={name:"Login",data(){return{form:{email:"",code:""},sendingCode:!1,loggingIn:!1,countdown:0,countdownTimer:null,emailRules:[{required:!0,message:"请输入邮箱地址"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"请输入正确的邮箱格式"}],codeRules:[{required:!0,message:"请输入验证码"},{pattern:/^\d{6}$/,message:"验证码必须是6位数字"}]}},computed:{canSendCode(){return this.form.email&&/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(this.form.email)&&0===this.countdown},sendButtonText(){return this.sendingCode?"发送中":this.countdown>0?`${this.countdown}s后重试`:"发送验证码"}},beforeDestroy(){this.countdownTimer&&clearInterval(this.countdownTimer)},methods:{...(0,a.i0)(["sendVerifyCode","login"]),async handleSendCode(){if(this.canSendCode)try{this.sendingCode=!0,await this.sendVerifyCode(this.form.email),s.A.success("验证码发送成功，请查收邮件"),this.startCountdown()}catch(e){console.error("发送验证码失败:",e),s.A.fail(e.message||"发送验证码失败")}finally{this.sendingCode=!1}},startCountdown(){this.countdown=60,this.countdownTimer=setInterval(()=>{this.countdown--,this.countdown<=0&&(clearInterval(this.countdownTimer),this.countdownTimer=null)},1e3)},async handleLogin(){if(this.form.email&&this.form.code)try{this.loggingIn=!0,await this.login({email:this.form.email,code:this.form.code}),s.A.success("登录成功");const e=this.$route.query.redirect||"/";this.$router.replace(e)}catch(e){console.error("登录失败:",e),s.A.fail(e.message||"登录失败")}finally{this.loggingIn=!1}}}},r=l,d=t(5229),c=(0,d.A)(r,o,i,!1,null,"4a222d5e",null),u=c.exports}}]);