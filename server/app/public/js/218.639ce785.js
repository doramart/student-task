(self["webpackChunk_student_task_client"]=self["webpackChunk_student_task_client"]||[]).push([[218],{218:function(t,a,s){"use strict";s.r(a),s.d(a,{default:function(){return k}});var e=function(){var t=this,a=t._self._c;return a("div",{staticClass:"statistics-view"},[a("van-nav-bar",{attrs:{title:"学习统计"}}),a("div",{staticClass:"time-range-selector"},[a("van-tabs",{on:{click:t.onTimeRangeChange},model:{value:t.activeTimeRange,callback:function(a){t.activeTimeRange=a},expression:"activeTimeRange"}},[a("van-tab",{attrs:{title:"最近7天",name:"week"}}),a("van-tab",{attrs:{title:"最近30天",name:"month"}}),a("van-tab",{attrs:{title:"自定义",name:"custom"}})],1)],1),"custom"===t.activeTimeRange?a("div",{staticClass:"custom-range"},[a("van-cell-group",[a("van-field",{attrs:{label:"开始日期",placeholder:"选择开始日期",readonly:""},on:{click:function(a){t.showStartPicker=!0}},model:{value:t.customRange.start,callback:function(a){t.$set(t.customRange,"start",a)},expression:"customRange.start"}}),a("van-field",{attrs:{label:"结束日期",placeholder:"选择结束日期",readonly:""},on:{click:function(a){t.showEndPicker=!0}},model:{value:t.customRange.end,callback:function(a){t.$set(t.customRange,"end",a)},expression:"customRange.end"}})],1),a("div",{staticClass:"range-actions"},[a("van-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.loadCustomStats}},[t._v(" 查看统计 ")])],1)],1):t._e(),a("div",{staticClass:"overview-stats"},[a("div",{staticClass:"stats-card"},[a("h3",{staticClass:"card-title"},[t._v("总体完成情况")]),a("div",{staticClass:"overview-grid"},[a("div",{staticClass:"overview-item"},[a("div",{staticClass:"overview-value"},[t._v(t._s(t.overviewStats.totalTasks))]),a("div",{staticClass:"overview-label"},[t._v("总任务数")])]),a("div",{staticClass:"overview-item"},[a("div",{staticClass:"overview-value"},[t._v(t._s(t.overviewStats.completedTasks))]),a("div",{staticClass:"overview-label"},[t._v("已完成")])]),a("div",{staticClass:"overview-item"},[a("div",{staticClass:"overview-value"},[t._v(" "+t._s(t.overviewStats.completionRate)+"% ")]),a("div",{staticClass:"overview-label"},[t._v("完成率")])]),a("div",{staticClass:"overview-item"},[a("div",{staticClass:"overview-value"},[t._v(t._s(t.streakDays))]),a("div",{staticClass:"overview-label"},[t._v("连续完成")])])])])]),a("div",{staticClass:"subject-stats"},[a("div",{staticClass:"stats-card"},[a("h3",{staticClass:"card-title"},[t._v("各科目完成率")]),a("div",{staticClass:"subject-list"},t._l(t.subjects,function(s){return a("div",{key:s,staticClass:"subject-item"},[a("div",{staticClass:"subject-header"},[a("span",{staticClass:"subject-name"},[t._v(t._s(s))]),a("span",{staticClass:"subject-percentage"},[t._v(" "+t._s(t.getSubjectStats(s).percentage)+"% ")])]),a("van-progress",{attrs:{percentage:t.getSubjectStats(s).percentage,color:t.getSubjectColor(s),"stroke-width":"8px","show-pivot":"","pivot-text":`${t.getSubjectStats(s).completed}/${t.getSubjectStats(s).total}`,"pivot-color":t.getSubjectColor(s)}}),a("div",{staticClass:"subject-detail"},[a("span",[t._v("完成 "+t._s(t.getSubjectStats(s).completed))]),a("span",[t._v("总计 "+t._s(t.getSubjectStats(s).total))])])],1)}),0)])]),a("div",{staticClass:"daily-trend"},[a("div",{staticClass:"stats-card"},[a("h3",{staticClass:"card-title"},[t._v("每日完成率趋势")]),a("div",{staticClass:"trend-chart"},[0===t.dailyStats.length?a("div",{staticClass:"no-data"},[t._v("暂无数据")]):a("div",{staticClass:"chart-container"},[a("div",{staticClass:"chart-grid"},t._l(t.dailyStats,function(s,e){return a("div",{key:e,staticClass:"chart-bar",style:{height:s.completionRate+"%"},attrs:{title:`${s.date}: ${s.completionRate}%`}},[a("div",{staticClass:"bar-value"},[t._v(t._s(s.completionRate)+"%")])])}),0),a("div",{staticClass:"chart-labels"},t._l(t.dailyStats,function(s,e){return a("div",{key:e,staticClass:"chart-label"},[t._v(" "+t._s(t.formatDateLabel(s.date))+" ")])}),0)])])])]),a("div",{staticClass:"habit-analysis"},[a("div",{staticClass:"stats-card"},[a("h3",{staticClass:"card-title"},[t._v("学习习惯分析")]),a("div",{staticClass:"habit-items"},[a("div",{staticClass:"habit-item"},[a("van-icon",{attrs:{name:"clock-o"}}),a("div",{staticClass:"habit-content"},[a("div",{staticClass:"habit-title"},[t._v("最活跃时间段")]),a("div",{staticClass:"habit-value"},[t._v(t._s(t.mostActiveTime))])])],1),a("div",{staticClass:"habit-item"},[a("van-icon",{attrs:{name:"award-o"}}),a("div",{staticClass:"habit-content"},[a("div",{staticClass:"habit-title"},[t._v("最擅长科目")]),a("div",{staticClass:"habit-value"},[t._v(t._s(t.bestSubject))])])],1),a("div",{staticClass:"habit-item"},[a("van-icon",{attrs:{name:"fire-o"}}),a("div",{staticClass:"habit-content"},[a("div",{staticClass:"habit-title"},[t._v("历史最长连续")]),a("div",{staticClass:"habit-value"},[t._v(t._s(t.maxStreak)+"天")])])],1)])])]),a("van-popup",{attrs:{position:"bottom"},model:{value:t.showStartPicker,callback:function(a){t.showStartPicker=a},expression:"showStartPicker"}},[a("van-datetime-picker",{attrs:{type:"date",title:"选择开始日期"},on:{confirm:t.onStartDateConfirm,cancel:function(a){t.showStartPicker=!1}},model:{value:t.startPickerDate,callback:function(a){t.startPickerDate=a},expression:"startPickerDate"}})],1),a("van-popup",{attrs:{position:"bottom"},model:{value:t.showEndPicker,callback:function(a){t.showEndPicker=a},expression:"showEndPicker"}},[a("van-datetime-picker",{attrs:{type:"date",title:"选择结束日期"},on:{confirm:t.onEndDateConfirm,cancel:function(a){t.showEndPicker=!1}},model:{value:t.endPickerDate,callback:function(a){t.endPickerDate=a},expression:"endPickerDate"}})],1),t.loading?a("van-loading",{staticClass:"loading-overlay",attrs:{type:"spinner",size:"24px"}},[t._v(" 加载中... ")]):t._e()],1)},i=[],c=(s(5639),s(9454),s(8291),s(1511),s(8092),s(7914),s(1406)),o=s(2368),n=s.n(o),r=s(891),l=s.n(r),d=s(1397),v=s(2479);n().extend(l());var u={name:"StatisticsView",data(){return{loading:!1,activeTimeRange:"week",showStartPicker:!1,showEndPicker:!1,startPickerDate:new Date,endPickerDate:new Date,customRange:{start:"",end:""},dailyStats:[],streakDays:0,maxStreak:0,mostActiveTime:"暂无数据",bestSubject:"暂无数据"}},computed:{...(0,c.aH)(["subjects"]),overviewStats(){if(!Array.isArray(this.dailyStats)||0===this.dailyStats.length)return{totalTasks:0,completedTasks:0,completionRate:0};const t=this.dailyStats.reduce((t,a)=>t+(a.totalTasks||0),0),a=this.dailyStats.reduce((t,a)=>t+(a.completedTasks||0),0),s=t>0?Math.round(a/t*100):0;return{totalTasks:t,completedTasks:a,completionRate:s}}},async created(){await this.loadStreak(),await this.loadStats()},methods:{async loadStats(){try{let t,a;switch(this.loading=!0,this.activeTimeRange){case"week":t=n()().subtract(6,"day").format("YYYY-MM-DD"),a=n()().format("YYYY-MM-DD");break;case"month":t=n()().subtract(29,"day").format("YYYY-MM-DD"),a=n()().format("YYYY-MM-DD");break;case"custom":t=this.customRange.start,a=this.customRange.end;break}if(!t||!a)return void(this.loading=!1);const s=await d.A.getStats(t,a);this.dailyStats=this.transformStatsData(s,t,a),this.analyzeHabits(),this.$nextTick(()=>{this.$forceUpdate()})}catch(t){console.error("加载统计数据失败:",t),this.$toast.fail("加载统计数据失败: "+t.message),this.dailyStats=[]}finally{this.loading=!1}},transformStatsData(t,a,s){const e=[],i=n()(a),c=n()(s),o=(c.diff(i,"day"),{date:i.format("YYYY-MM-DD"),totalTasks:t.total||0,completedTasks:t.completed||0,completionRate:t.total>0?Math.round(t.completed/t.total*100):0,subjects:this.subjects.map(a=>({subject:a,total:t.subjects[a]?.total||0,completed:t.subjects[a]?.completed||0}))});return e.push(o),e},async loadCustomStats(){this.customRange.start&&this.customRange.end?n()(this.customRange.start).isAfter(n()(this.customRange.end))?this.$toast.fail("开始日期不能晚于结束日期"):await this.loadStats():this.$toast.fail("请选择时间范围")},async loadStreak(){try{const t=await d.A.getStreak();this.streakDays=t.streak,this.analyzeHabits()}catch(t){console.error("加载连续天数失败:",t),this.streakDays=0,this.analyzeHabits()}},async onTimeRangeChange(){if("custom"!==this.activeTimeRange)try{await this.loadStreak(),await this.loadStats()}catch(t){console.error("切换时间范围时加载数据失败:",t)}},onStartDateConfirm(t){this.customRange.start=n()(t).format("YYYY-MM-DD"),this.showStartPicker=!1},onEndDateConfirm(t){this.customRange.end=n()(t).format("YYYY-MM-DD"),this.showEndPicker=!1},getSubjectStats(t){if(!Array.isArray(this.dailyStats))return{total:0,completed:0,percentage:0};let a=0,s=0;this.dailyStats.forEach(e=>{if(e.subjects&&Array.isArray(e.subjects)){const i=e.subjects.find(a=>a.subject===t);i&&(a+=i.total||0,s+=i.completed||0)}});const e=a>0?Math.round(s/a*100):0;return{total:a,completed:s,percentage:e}},getSubjectColor:v._o,formatDateLabel(t){return n()(t).format("MM-DD")},analyzeHabits(){if(0===this.dailyStats.length)return;let t={subject:"",rate:0};this.subjects.forEach(a=>{const s=this.getSubjectStats(a);s.percentage>t.rate&&(t={subject:a,rate:s.percentage})}),this.bestSubject=t.subject||"暂无数据",this.maxStreak=Math.max(this.streakDays||0,0),this.mostActiveTime="18:00-20:00"}}},m=u,h=s(5229),b=(0,h.A)(m,e,i,!1,null,"5929de11",null),k=b.exports},891:function(t){!function(a,s){t.exports=s()}(0,function(){"use strict";return function(t,a){a.prototype.isSameOrBefore=function(t,a){return this.isSame(t,a)||this.isBefore(t,a)}}})}}]);