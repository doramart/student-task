"use strict";(self["webpackChunk_student_task_client"]=self["webpackChunk_student_task_client"]||[]).push([[115],{9115:function(t,a,e){e.r(a),e.d(a,{default:function(){return D}});var s=function(){var t=this,a=t._self._c;return a("div",{staticClass:"calendar-view"},[a("van-nav-bar",{attrs:{title:"任务日历"}}),a("div",{staticClass:"month-selector"},[a("van-button",{attrs:{size:"small",disabled:t.loading},on:{click:function(a){return t.changeMonth(-1)}}},[a("van-icon",{attrs:{name:"arrow-left"}}),t._v(" 上月 ")],1),a("div",{staticClass:"month-info"},[a("span",{staticClass:"current-month"},[t._v(t._s(t.currentMonthText))]),a("van-button",{staticClass:"today-btn",attrs:{size:"mini",type:"primary",plain:"",disabled:t.loading||t.isCurrentMonth},on:{click:t.goToToday}},[t._v(" 今天 ")])],1),a("van-button",{attrs:{size:"small",disabled:t.loading||t.isCurrentMonth},on:{click:function(a){return t.changeMonth(1)}}},[t._v(" 下月 "),a("van-icon",{attrs:{name:"arrow"}})],1)],1),a("div",{staticClass:"calendar-container"},[a("van-calendar",{attrs:{"default-date":t.defaultDate,"min-date":t.minDate,"max-date":t.maxDate,formatter:t.dayFormatter,"show-confirm":!1,readonly:!1},on:{select:t.onDateSelect},model:{value:t.showCalendar,callback:function(a){t.showCalendar=a},expression:"showCalendar"}})],1),t.monthStats?a("div",{staticClass:"month-stats"},[a("van-card",{scopedSlots:t._u([{key:"title",fn:function(){return[a("span",[t._v(t._s(t.currentMonthText)+"统计")])]},proxy:!0}],null,!1,648713082)},[a("div",{staticClass:"stats-grid"},[a("div",{staticClass:"stat-item"},[a("div",{staticClass:"stat-value"},[t._v(t._s(t.monthStats.totalDays))]),a("div",{staticClass:"stat-label"},[t._v("有任务天数")])]),a("div",{staticClass:"stat-item"},[a("div",{staticClass:"stat-value"},[t._v(t._s(t.monthStats.completedDays))]),a("div",{staticClass:"stat-label"},[t._v("完成天数")])]),a("div",{staticClass:"stat-item"},[a("div",{staticClass:"stat-value"},[t._v(t._s(t.monthStats.completionRate)+"%")]),a("div",{staticClass:"stat-label"},[t._v("完成率")])])])])],1):t._e(),a("van-popup",{style:{height:"60%"},attrs:{position:"bottom"},model:{value:t.showDateDetail,callback:function(a){t.showDateDetail=a},expression:"showDateDetail"}},[a("div",{staticClass:"date-detail"},[a("div",{staticClass:"detail-header"},[a("h3",[t._v(t._s(t.selectedDateText))]),a("van-button",{attrs:{plain:""},on:{click:function(a){t.showDateDetail=!1}}},[t._v("关闭")])],1),a("div",{staticClass:"detail-content"},[0===t.selectedDateTasks.length?a("div",{staticClass:"no-tasks"},[t._v(" 该日期没有任务记录 ")]):a("div",[a("div",{staticClass:"date-stats"},[a("span",[t._v("总任务: "+t._s(t.selectedDateTasks.length))]),a("span",[t._v("已完成: "+t._s(t.completedTasksCount))]),a("span",[t._v("完成率: "+t._s(t.selectedDateCompletionRate)+"%")])]),a("div",{staticClass:"tasks-list"},t._l(t.selectedDateTasks,function(e){return a("div",{key:e._id,staticClass:"task-item",class:{completed:e.isCompleted}},[a("van-icon",{attrs:{name:e.isCompleted?"checked":"circle",color:e.isCompleted?"#1989fa":"#c8c9cc"}}),a("div",{staticClass:"task-content"},[a("div",{staticClass:"task-title"},[t._v(t._s(e.title))]),a("div",{staticClass:"task-meta"},[a("van-tag",{attrs:{color:t.getSubjectColor(e.subject),size:"mini",plain:""}},[t._v(" "+t._s(e.subject)+" ")]),e.completedAt?a("span",{staticClass:"completed-time"},[t._v(" "+t._s(t.formatTime(e.completedAt))+"完成 ")]):t._e()],1)])],1)}),0)])])])]),t.loading?a("van-loading",{staticClass:"loading-overlay",attrs:{type:"spinner",size:"24px"}},[t._v(" 加载中... ")]):t._e()],1)},n=[],i=(e(9454),e(5010),e(8291),e(1406)),l=e(2368),o=e.n(l),c=e(1397),r=e(2479),d={name:"CalendarView",data(){return{showCalendar:!0,showDateDetail:!1,loading:!1,currentMonth:o()().format("YYYY-MM"),calendarData:[],selectedDate:null,selectedDateTasks:[],minDate:new Date(2020,0,1),maxDate:new Date,defaultDate:new Date}},computed:{...(0,i.aH)(["subjects"]),calendarDate(){return new Date(this.currentMonth+"-01")},currentMonthText(){return o()(this.currentMonth).format("YYYY年MM月")},isCurrentMonth(){return this.currentMonth===o()().format("YYYY-MM")},selectedDateText(){return this.selectedDate?o()(this.selectedDate).format("YYYY年MM月DD日"):""},completedTasksCount(){return this.selectedDateTasks.filter(t=>t.isCompleted).length},selectedDateCompletionRate(){return 0===this.selectedDateTasks.length?0:Math.round(this.completedTasksCount/this.selectedDateTasks.length*100)},monthStats(){if(0===this.calendarData.length)return null;const t=this.calendarData.length,a=this.calendarData.filter(t=>"completed"===t.status).length,e=t>0?Math.round(a/t*100):0;return{totalDays:t,completedDays:a,completionRate:e}}},async created(){await this.loadCalendarData();const t=o()().format("YYYY-MM-DD");await this.loadTodayTasks(t)},methods:{async loadCalendarData(){try{this.loading=!0,this.calendarData=await c.A.getCalendarData(this.currentMonth)}catch(t){console.error("加载日历数据失败:",t),this.$toast.fail("加载日历数据失败: "+t.message),this.calendarData=[]}finally{this.loading=!1}},async changeMonth(t){const a=o()(this.currentMonth).add(t,"month");if(a.isAfter(o()(),"month"))this.$toast("不能查看未来月份");else{this.currentMonth=a.format("YYYY-MM");try{await this.loadCalendarData()}catch(e){console.error("切换月份时加载数据失败:",e)}}},dayFormatter(t){const a=o()(t.date).format("YYYY-MM-DD"),e=o()().format("YYYY-MM-DD"),s=this.calendarData.find(t=>t.date===a);let n="",i="";if(a===e&&(n+=" today"),s)switch(n+=" has-tasks",s.status){case"completed":n+=" completed",i="✅";break;case"partial":n+=" partial",i="📝";break;case"pending":n+=" pending",i="⏳";break}return{...t,className:n,bottomInfo:i}},async onDateSelect(t){const a=o()(t).format("YYYY-MM-DD");await this.loadTodayTasks(a),this.showDateDetail=!0},async loadTodayTasks(t){try{this.loading=!0,this.selectedDate=t,this.selectedDateTasks=await c.A.getTasks(t)}catch(a){console.error("加载任务详情失败:",a),this.$toast.fail("加载任务详情失败: "+a.message),this.selectedDateTasks=[]}finally{this.loading=!1}},getSubjectColor:r._o,formatTime(t){return o()(t).format("HH:mm")},async goToToday(){const t=o()(),a=t.format("YYYY-MM"),e=t.format("YYYY-MM-DD");try{this.currentMonth!==a&&(this.currentMonth=a,await this.loadCalendarData()),await this.loadTodayTasks(e),this.showDateDetail=!0}catch(s){console.error("跳转到今天时失败:",s)}}}},h=d,m=e(5229),u=(0,m.A)(h,s,n,!1,null,"4366d861",null),D=u.exports}}]);